{"version":3,"file":"index.mjs","sources":["../../src/focustrap/BaseFocusTrap.js","../../src/focustrap/FocusTrap.js"],"sourcesContent":["import BaseDirective from '@primevue/core/basedirective';\nimport FocusTrapStyle from 'primevue/focustrap/style';\n\nconst BaseFocusTrap = BaseDirective.extend({\n    style: FocusTrapStyle\n});\n\nexport default BaseFocusTrap;\n","import { createElement, focus, getFirstFocusableElement, getLastFocusableElement, isFocusableElement } from '@primeuix/utils/dom';\nimport { isNotEmpty } from '@primeuix/utils/object';\nimport BaseFocusTrap from './BaseFocusTrap';\n\nconst FocusTrap = BaseFocusTrap.extend('focustrap', {\n    mounted(el, binding) {\n        const { disabled } = binding.value || {};\n\n        if (!disabled) {\n            this.createHiddenFocusableElements(el, binding);\n            this.bind(el, binding);\n            this.autoElementFocus(el, binding);\n        }\n\n        el.setAttribute('data-pd-focustrap', true);\n\n        this.$el = el;\n    },\n    updated(el, binding) {\n        const { disabled } = binding.value || {};\n\n        disabled && this.unbind(el);\n    },\n    unmounted(el) {\n        this.unbind(el);\n    },\n    methods: {\n        getComputedSelector(selector) {\n            return `:not(.p-hidden-focusable):not([data-p-hidden-focusable=\"true\"])${selector ?? ''}`;\n        },\n        bind(el, binding) {\n            const { onFocusIn, onFocusOut } = binding.value || {};\n\n            el.$_pfocustrap_mutationobserver = new MutationObserver((mutationList) => {\n                mutationList.forEach((mutation) => {\n                    if (mutation.type === 'childList' && !el.contains(document.activeElement)) {\n                        const findNextFocusableElement = (_el) => {\n                            const focusableElement = isFocusableElement(_el)\n                                ? isFocusableElement(_el, this.getComputedSelector(el.$_pfocustrap_focusableselector))\n                                    ? _el\n                                    : getFirstFocusableElement(el, this.getComputedSelector(el.$_pfocustrap_focusableselector))\n                                : getFirstFocusableElement(_el);\n\n                            return isNotEmpty(focusableElement) ? focusableElement : _el.nextSibling && findNextFocusableElement(_el.nextSibling);\n                        };\n\n                        focus(findNextFocusableElement(mutation.nextSibling));\n                    }\n                });\n            });\n\n            el.$_pfocustrap_mutationobserver.disconnect();\n            el.$_pfocustrap_mutationobserver.observe(el, {\n                childList: true\n            });\n\n            el.$_pfocustrap_focusinlistener = (event) => onFocusIn && onFocusIn(event);\n            el.$_pfocustrap_focusoutlistener = (event) => onFocusOut && onFocusOut(event);\n\n            el.addEventListener('focusin', el.$_pfocustrap_focusinlistener);\n            el.addEventListener('focusout', el.$_pfocustrap_focusoutlistener);\n        },\n        unbind(el) {\n            el.$_pfocustrap_mutationobserver && el.$_pfocustrap_mutationobserver.disconnect();\n            el.$_pfocustrap_focusinlistener && el.removeEventListener('focusin', el.$_pfocustrap_focusinlistener) && (el.$_pfocustrap_focusinlistener = null);\n            el.$_pfocustrap_focusoutlistener && el.removeEventListener('focusout', el.$_pfocustrap_focusoutlistener) && (el.$_pfocustrap_focusoutlistener = null);\n        },\n        autoFocus(options) {\n            this.autoElementFocus(this.$el, { value: { ...options, autoFocus: true } });\n        },\n        autoElementFocus(el, binding) {\n            const { autoFocusSelector = '', firstFocusableSelector = '', autoFocus = false } = binding.value || {};\n            let focusableElement = getFirstFocusableElement(el, `[autofocus]${this.getComputedSelector(autoFocusSelector)}`);\n\n            autoFocus && !focusableElement && (focusableElement = getFirstFocusableElement(el, this.getComputedSelector(firstFocusableSelector)));\n            focus(focusableElement);\n        },\n        onFirstHiddenElementFocus(event) {\n            const { currentTarget, relatedTarget } = event;\n            const focusableElement =\n                relatedTarget === currentTarget.$_pfocustrap_lasthiddenfocusableelement || !this.$el?.contains(relatedTarget)\n                    ? getFirstFocusableElement(currentTarget.parentElement, this.getComputedSelector(currentTarget.$_pfocustrap_focusableselector))\n                    : currentTarget.$_pfocustrap_lasthiddenfocusableelement;\n\n            focus(focusableElement);\n        },\n        onLastHiddenElementFocus(event) {\n            const { currentTarget, relatedTarget } = event;\n            const focusableElement =\n                relatedTarget === currentTarget.$_pfocustrap_firsthiddenfocusableelement || !this.$el?.contains(relatedTarget)\n                    ? getLastFocusableElement(currentTarget.parentElement, this.getComputedSelector(currentTarget.$_pfocustrap_focusableselector))\n                    : currentTarget.$_pfocustrap_firsthiddenfocusableelement;\n\n            focus(focusableElement);\n        },\n        createHiddenFocusableElements(el, binding) {\n            const { tabIndex = 0, firstFocusableSelector = '', lastFocusableSelector = '' } = binding.value || {};\n\n            const createFocusableElement = (onFocus) => {\n                return createElement('span', {\n                    class: 'p-hidden-accessible p-hidden-focusable',\n                    tabIndex,\n                    role: 'presentation',\n                    'aria-hidden': true,\n                    'data-p-hidden-accessible': true,\n                    'data-p-hidden-focusable': true,\n                    onFocus: onFocus?.bind(this)\n                });\n            };\n\n            const firstFocusableElement = createFocusableElement(this.onFirstHiddenElementFocus);\n            const lastFocusableElement = createFocusableElement(this.onLastHiddenElementFocus);\n\n            firstFocusableElement.$_pfocustrap_lasthiddenfocusableelement = lastFocusableElement;\n            firstFocusableElement.$_pfocustrap_focusableselector = firstFocusableSelector;\n            firstFocusableElement.setAttribute('data-pc-section', 'firstfocusableelement');\n\n            lastFocusableElement.$_pfocustrap_firsthiddenfocusableelement = firstFocusableElement;\n            lastFocusableElement.$_pfocustrap_focusableselector = lastFocusableSelector;\n            lastFocusableElement.setAttribute('data-pc-section', 'lastfocusableelement');\n\n            el.prepend(firstFocusableElement);\n            el.append(lastFocusableElement);\n        }\n    }\n});\n\nexport default FocusTrap;\n"],"names":["BaseFocusTrap","BaseDirective","extend","style","FocusTrapStyle","FocusTrap","mounted","el","binding","_ref","value","disabled","createHiddenFocusableElements","bind","autoElementFocus","setAttribute","$el","updated","_ref2","unbind","unmounted","methods","getComputedSelector","selector","concat","_this","_ref3","onFocusIn","onFocusOut","$_pfocustrap_mutationobserver","MutationObserver","mutationList","forEach","mutation","type","contains","document","activeElement","findNextFocusableElement","_el","focusableElement","isFocusableElement","$_pfocustrap_focusableselector","getFirstFocusableElement","isNotEmpty","nextSibling","focus","disconnect","observe","childList","$_pfocustrap_focusinlistener","event","$_pfocustrap_focusoutlistener","addEventListener","removeEventListener","autoFocus","options","_objectSpread","_ref4","_ref4$autoFocusSelect","autoFocusSelector","_ref4$firstFocusableS","firstFocusableSelector","_ref4$autoFocus","onFirstHiddenElementFocus","_this$$el","currentTarget","relatedTarget","$_pfocustrap_lasthiddenfocusableelement","parentElement","onLastHiddenElementFocus","_this$$el2","$_pfocustrap_firsthiddenfocusableelement","getLastFocusableElement","_this2","_ref5","_ref5$tabIndex","tabIndex","_ref5$firstFocusableS","_ref5$lastFocusableSe","lastFocusableSelector","createFocusableElement","onFocus","createElement","role","firstFocusableElement","lastFocusableElement","prepend","append"],"mappings":"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"}